package utils;

import base.BaseTest;
import org.apache.commons.io.FileUtils;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.TakesScreenshot;
import org.openqa.selenium.WebDriver;

import java.io.File;
import java.io.IOException;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

public class CaptureScreenshot {

    public static String capture(String screenName) throws IOException {
        WebDriver driver = BaseTest.getDriver();
        if (driver == null) {
            throw new IllegalStateException("No WebDriver instance available");
        }
        
        // Create screenshots directory if it doesn't exist
        File screenshotsDir = new File("screenshots");
        if (!screenshotsDir.exists()) {
            screenshotsDir.mkdirs();  // Creates the directory and any necessary parent directories
        }
        
        TakesScreenshot ts = (TakesScreenshot) driver;
        File source = ts.getScreenshotAs(OutputType.FILE);
        
        // Use consistent timestamp format matching your report
        String timeStamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyy.MM.dd.HH.mm.ss"));
        String fileName = screenName + "_" + timeStamp + ".png";
        File destFile = new File("screenshots/" + fileName);
        
        FileUtils.copyFile(source, destFile);
        
        // Return relative path for better compatibility with ExtentReports
        return destFile.getPath();
    }
}